/**
 * PureSuck 主题退出动画
 * 
 * 包含：
 * - 列表页退出动画
 * - 文章页退出动画
 * - 独立页面退出动画
 * - VT 模式下的特殊退出动画
 * 
 * 动画设计原则：
 * 1. 退出动画：淡出 + 轻微缩小 + 方向性位移
 * 2. 对称性：退出和进入形成视觉对称
 * 3. 层次感：主要元素先动，次要元素后动
 * 4. GPU 加速：使用 transform: translate3d 和 will-change
 */

/* ==================== 列表页退出动画 ==================== */

/*
 * 列表页退出动画
 * 效果：卡片逐个淡出 + 缩小 + 轻微上移
 * 使用 GPU 加速优化性能
 */
html.ps-list-exit .post.post--index {
	animation: ps-list-exit-out var(--ps-anim-duration-normal) var(--ps-anim-ease-out) forwards;
	animation-fill-mode: both;
}

/* VT模式下的列表卡片退出动画（用于非点击的卡片） */
html.ps-list-exit #swup.ps-vt-mode .post.post--index:not([data-ps-vt-name]) {
	animation: ps-list-card-exit-for-vt var(--ps-anim-duration-vt) var(--ps-anim-ease-out) forwards;
}

/* 共享元素卡片（被点击的）：淡出 + 缩小 */
html.ps-list-exit #swup.ps-vt-mode .post.post--index[data-ps-vt-name] {
	animation: ps-list-shared-exit var(--ps-anim-duration-slow) var(--ps-anim-ease-out) forwards;
}

/* 列表页退出动画关键帧 */
@keyframes ps-list-exit-out {
	from {
		opacity: 1;
		transform: translate3d(0, 0, 0) scale(1);
	}
	to {
		opacity: 0;
		transform: translate3d(0, -12px, 0) scale(var(--ps-anim-scale-exit));
	}
}

@keyframes ps-list-card-exit-for-vt {
	from {
		opacity: 1;
		transform: translate3d(0, 0, 0) scale(1);
	}
	to {
		opacity: 0.4;
		transform: translate3d(0, -8px, 0) scale(0.98);
	}
}

@keyframes ps-list-shared-exit {
	from {
		opacity: 1;
		transform: translate3d(0, 0, 0) scale(1);
	}
	to {
		opacity: 0;
		transform: translate3d(0, -16px, 0) scale(0.94);
	}
}

/* 列表页退出：卡片延迟效果（波浪式退出） */
html.ps-list-exit .post.post--index:nth-child(1) { animation-delay: 0ms; }
html.ps-list-exit .post.post--index:nth-child(2) { animation-delay: 25ms; }
html.ps-list-exit .post.post--index:nth-child(3) { animation-delay: 50ms; }
html.ps-list-exit .post.post--index:nth-child(4) { animation-delay: 75ms; }
html.ps-list-exit .post.post--index:nth-child(5) { animation-delay: 100ms; }
html.ps-list-exit .post.post--index:nth-child(6) { animation-delay: 120ms; }
html.ps-list-exit .post.post--index:nth-child(7) { animation-delay: 140ms; }
html.ps-list-exit .post.post--index:nth-child(8) { animation-delay: 160ms; }
html.ps-list-exit .post.post--index:nth-child(n+9) { animation-delay: 180ms; }

/* 列表页退出：辅助元素延迟更久 */
html.ps-list-exit .archive-title {
	animation: ps-list-exit-out 200ms var(--ps-anim-ease-out) forwards;
	animation-delay: 40ms;
}
html.ps-list-exit .main-pager,
html.ps-list-exit .main-lastinfo {
	animation: ps-list-exit-out 180ms var(--ps-anim-ease-out) forwards;
	animation-delay: 100ms;
}

/* ==================== 文章页退出动画 ==================== */

/*
 * 文章页退出动画
 * 效果：整体淡出 + 轻微上移 + 缩小
 */
html.ps-post-exit .post.post--single {
	animation: ps-post-exit-out var(--ps-anim-duration-slow) var(--ps-anim-ease-out) forwards;
}

/* 文章页内容分段退出 - 已移除以避免与父元素动画冲突 */
/* 子元素会跟随父元素 .post.post--single 的动画一起退出 */
/* 这样可以避免合成失败，提升性能 */

/* 文章页退出动画关键帧 */
@keyframes ps-post-exit-out {
	from {
		opacity: 1;
		transform: translate3d(0, 0, 0) scale(1);
	}
	to {
		opacity: 0;
		transform: translate3d(0, var(--ps-anim-translate-medium), 0) scale(0.98);
	}
}

/* ==================== 独立页面退出动画 ==================== */

/*
 * 独立页面退出动画
 * 效果：卡片淡出 + 上移 + 缩小
 */
html.ps-page-exit .post.post--index.main-item:not(.post--single) {
	animation: ps-page-exit-out var(--ps-anim-duration-slow) var(--ps-anim-ease-out) forwards;
}

/* 独立页面内部内容退出 - 已移除以避免与父元素动画冲突 */
/* 子元素会跟随父元素 .post.post--index.main-item 的动画一起退出 */
/* 这样可以避免合成失败，提升性能 */

/* 独立页面退出动画关键帧 */
@keyframes ps-page-exit-out {
	from {
		opacity: 1;
		transform: translate3d(0, 0, 0) scale(1);
	}
	to {
		opacity: 0;
		transform: translate3d(0, -20px, 0) scale(0.97);
	}
}

/* ps-page-inner-exit-out 动画已移除 - 不再需要 */
/* 子元素跟随父元素动画，避免动画冲突 */

/* ==================== VT 模式下非 morph 元素淡出 ==================== */

/*
 * 使用 #swup.ps-vt-mode 替代 html.ps-vt-mode
 * 减少样式计算范围：只检查 #swup 内的元素
 */
@keyframes ps-vt-fade-out {
	from {
		opacity: 1;
		transform: translate3d(0, 0, 0);
	}
	to {
		opacity: 0;
		transform: translate3d(0, -8px, 0);
	}
}

/* 被点击卡片中不参与 morph 的元素淡出 */
#swup.ps-vt-mode .post.post--index[data-ps-vt-name^="ps-post-"] .post-excerpt,
#swup.ps-vt-mode .post.post--index[data-ps-vt-name^="ps-post-"] .post-footer,
#swup.ps-vt-mode .post.post--index[data-ps-vt-name^="ps-post-"] .post-cat-vertical {
	animation: ps-vt-fade-out calc(var(--ps-vt-duration) * 0.5) var(--ps-anim-ease-out) forwards;
}

/* ==================== VT 性能优化：隐藏复杂内容 ==================== */

/*
 * VT 期间隐藏文章页容器内的复杂内容
 * 使用 display: none 完全从 DOM 树中移除，减少 VT 快照计算开销
 * 比 content-visibility 更彻底：VT 快照完全跳过这些元素
 * #swup.ps-vt-mode 类在 VT 结束后移除，内容自动恢复
 */
#swup.ps-vt-mode .post.post--single .post-content,
#swup.ps-vt-mode .post.post--single .post-comments,
#swup.ps-vt-mode .post.post--single .license-info-card,
#swup.ps-vt-mode .post.post--single .post-footer {
	display: none !important;
}

/* ==================== 无障碍支持 ==================== */

/* 用户偏好减少动画时，禁用所有退出动画 */
@media (prefers-reduced-motion: reduce) {
	html.ps-page-exit .post.post--index.main-item:not(.post--single),
	html.ps-post-exit .post.post--single,
	html.ps-list-exit .post.post--index,
	html.ps-page-exit .post.post--index .post-title,
	html.ps-page-exit .post.post--index .post-meta,
	html.ps-page-exit .post.post--index .inner-post-wrapper > *,
	/* VT 元素淡出 */
	#swup.ps-vt-mode .post.post--index[data-ps-vt-name^="ps-post-"] .post-excerpt,
	#swup.ps-vt-mode .post.post--index[data-ps-vt-name^="ps-post-"] .post-footer,
	#swup.ps-vt-mode .post.post--index[data-ps-vt-name^="ps-post-"] .post-cat-vertical {
		animation: none !important;
		opacity: 1 !important;
		transform: none !important;
		will-change: auto !important;
	}

	/* VT 复杂内容隐藏 */
	#swup.ps-vt-mode .post.post--single .post-content,
	#swup.ps-vt-mode .post.post--single .post-comments,
	#swup.ps-vt-mode .post.post--single .license-info-card,
	#swup.ps-vt-mode .post.post--single .post-footer {
		display: block !important;
	}
}
