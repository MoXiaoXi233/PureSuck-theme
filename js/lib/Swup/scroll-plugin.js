!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):(t||self).SwupScrollPlugin=o()}(this,function(){function t(){return t=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},t.apply(this,arguments)}const o=t=>String(t).split(".").map(t=>String(parseInt(t||"0",10))).concat(["0","0"]).slice(0,3).join(".");class e{constructor(){this.isSwupPlugin=!0,this.swup=void 0,this.version=void 0,this.requires={},this.handlersToUnregister=[]}mount(){}unmount(){this.handlersToUnregister.forEach(t=>t()),this.handlersToUnregister=[]}_beforeMount(){if(!this.name)throw new Error("You must define a name of plugin when creating a class.")}_afterUnmount(){}_checkRequirements(){return"object"!=typeof this.requires||Object.entries(this.requires).forEach(([t,e])=>{if(!function(t,e,n){const s=function(t,o){var e;if("swup"===t)return null!=(e=o.version)?e:"";{var n;const e=o.findPlugin(t);return null!=(n=null==e?void 0:e.version)?n:""}}(t,n);return!!s&&((t,e)=>e.every(e=>{const[,n,s]=e.match(/^([\D]+)?(.*)$/)||[];var r,i;return((t,o)=>{const e={"":t=>0===t,">":t=>t>0,">=":t=>t>=0,"<":t=>t<0,"<=":t=>t<=0};return(e[o]||e[""])(t)})((i=s,r=o(r=t),i=o(i),r.localeCompare(i,void 0,{numeric:!0})),n||">=")}))(s,e)}(t,e=Array.isArray(e)?e:[e],this.swup)){const o=`${t} ${e.join(", ")}`;throw new Error(`Plugin version mismatch: ${this.name} requires ${o}`)}}),!0}on(t,o,e={}){var n;o=!(n=o).name.startsWith("bound ")||n.hasOwnProperty("prototype")?o.bind(this):o;const s=this.swup.hooks.on(t,o,e);return this.handlersToUnregister.push(s),s}once(o,e,n={}){return this.on(o,e,t({},n,{once:!0}))}before(o,e,n={}){return this.on(o,e,t({},n,{before:!0}))}replace(o,e,n={}){return this.on(o,e,t({},n,{replace:!0}))}off(t,o){return this.swup.hooks.off(t,o)}}const n=(t,o=document)=>Array.from(o.querySelectorAll(t)),s=t=>"object"==typeof t&&null!=t&&1===t.nodeType,r=(t,o)=>(!o||"hidden"!==t)&&"visible"!==t&&"clip"!==t,i=(t,o)=>{if(t.clientHeight<t.scrollHeight||t.clientWidth<t.scrollWidth){const e=getComputedStyle(t,null);return r(e.overflowY,o)||r(e.overflowX,o)||(t=>{const o=(t=>{if(!t.ownerDocument||!t.ownerDocument.defaultView)return null;try{return t.ownerDocument.defaultView.frameElement}catch(t){return null}})(t);return!!o&&(o.clientHeight<t.scrollHeight||o.clientWidth<t.scrollWidth)})(t)}return!1},l=(t,o,e,n,s,r,i,l)=>r<t&&i>o||r>t&&i<o?0:r<=t&&l<=e||i>=o&&l>=e?r-t-n:i>o&&l<e||r<t&&l>e?i-o+s:0,c=t=>{const o=t.parentElement;return null==o?t.getRootNode().host||null:o};return class extends e{constructor(t={}){super(),this.name="SwupScrollPlugin",this.requires={swup:">=4.2.0"},this.defaults={doScrollingRightAway:!1,animateScroll:{betweenPages:!0,samePageWithHash:!0,samePage:!0},getAnchorElement:void 0,offset:0,scrollContainers:"[data-swup-scroll-container]",shouldResetScrollPosition:()=>!0,markScrollTarget:!1,scrollFunction:void 0},this.options=void 0,this.cachedScrollPositions={},this.previousScrollRestoration=void 0,this.currentCacheKey=void 0,this.getAnchorElement=(t="")=>"function"==typeof this.options.getAnchorElement?this.options.getAnchorElement(t):this.swup.getAnchorElement(t),this.getOffset=(t,o,e)=>{let n;return n="function"==typeof this.options.offset?this.options.offset(t,o,e):this.options.offset,"object"==typeof n&&"number"==typeof n.top&&"number"==typeof n.left?n:{top:parseInt(String(n??""),10)||0,left:0}},this.onBeforeLinkToSelf=t=>{t.scroll.animate=this.shouldAnimate("samePage")},this.handleScrollToTop=t=>(this.scrollTo({top:0,left:0},t.scroll.animate),!0),this.onBeforeLinkToAnchor=t=>{t.scroll.animate=this.shouldAnimate("samePageWithHash")},this.handleScrollToAnchor=(t,{hash:o})=>this.maybeScrollToAnchor(o,t.scroll.animate),this.onBeforeVisitStart=t=>{t.scroll.scrolledToContent=!1,t.scroll.animate=this.shouldAnimate("betweenPages")},this.onVisitStart=t=>{this.cacheScrollPositions(t.from.url),this.maybeResetScrollPositions(t),t.scroll.animate&&this.options.doScrollingRightAway&&!(t.scroll.target??t.to.hash)&&this.doScrollingBetweenPages(t)},this.handleScrollToContent=t=>{t.scroll.scrolledToContent||this.doScrollingBetweenPages(t),this.restoreScrollContainers(t.to.url)},this.doScrollingBetweenPages=t=>{if(t.history.popstate&&!t.animation.animate)return;const o=t.scroll.target??t.to.hash;if(o&&this.maybeScrollToAnchor(o,t.scroll.animate))return;if(!t.scroll.reset)return;const e=this.getCachedScrollPositions(t.to.url),{top:n=0,left:s=0}=e?.window||{top:0,left:0};requestAnimationFrame(()=>this.scrollTo({top:n,left:s},t.scroll.animate)),t.scroll.scrolledToContent=!0},this.maybeResetScrollPositions=t=>{const{popstate:o}=t.history,{url:e}=t.to,{el:n}=t.trigger;o||n&&!this.options.shouldResetScrollPosition(n)||this.resetScrollPositions(e)},this.options={...this.defaults,...t}}mount(){const t=this.swup;t.hooks.create("scroll:start"),t.hooks.create("scroll:end"),t.scrollTo=this.scrollTo.bind(this),this.previousScrollRestoration=window.history.scrollRestoration,t.options.animateHistoryBrowsing&&(window.history.scrollRestoration="manual"),this.updateScrollTarget=this.updateScrollTarget.bind(this),this.options.markScrollTarget&&(window.addEventListener("popstate",this.updateScrollTarget),window.addEventListener("hashchange",this.updateScrollTarget),this.on("page:view",this.updateScrollTarget),this.on("link:anchor",this.updateScrollTarget),this.on("link:self",this.updateScrollTarget),this.updateScrollTarget()),this.before("visit:start",this.onBeforeVisitStart,{priority:-1}),this.on("visit:start",this.onVisitStart,{priority:1}),this.replace("content:scroll",this.handleScrollToContent),this.before("link:self",this.onBeforeLinkToSelf,{priority:-1}),this.replace("scroll:top",this.handleScrollToTop),this.before("link:anchor",this.onBeforeLinkToAnchor,{priority:-1}),this.replace("scroll:anchor",this.handleScrollToAnchor)}unmount(){super.unmount(),this.previousScrollRestoration&&(window.history.scrollRestoration=this.previousScrollRestoration),window.removeEventListener("popstate",this.updateScrollTarget),window.removeEventListener("hashchange",this.updateScrollTarget),this.cachedScrollPositions={},delete this.swup.scrollTo}shouldAnimate(t){return"boolean"==typeof this.options.animateScroll?this.options.animateScroll:this.options.animateScroll[t]}maybeScrollToAnchor(t,o=!1){if(!t)return!1;const e=this.getAnchorElement(t);return e?e instanceof Element?(this.scrollElementIntoView(e,o),!0):(console.warn(`Anchor target ${t} is not a DOM node`),!1):(console.warn(`Anchor target ${t} not found`),!1)}cacheScrollPositions(t){const o=this.swup.resolveUrl(t),e=n(this.options.scrollContainers).map(t=>({top:t.scrollTop,left:t.scrollLeft})),s={window:{top:window.scrollY,left:window.scrollX},containers:e};this.cachedScrollPositions[o]=s}resetScrollPositions(t){const o=this.swup.resolveUrl(t);delete this.cachedScrollPositions[o]}getCachedScrollPositions(t){const o=this.swup.resolveUrl(t);return this.cachedScrollPositions[o]}restoreScrollContainers(t){const o=this.getCachedScrollPositions(t);o&&0!==o.containers.length&&n(this.options.scrollContainers).forEach((t,e)=>{const n=o.containers[e];null!=n&&(t.scrollTop=n.top,t.scrollLeft=n.left)})}updateScrollTarget(){const{hash:t}=window.location,o=document.querySelector("[data-swup-scroll-target]");let e=this.getAnchorElement(t);e instanceof HTMLBodyElement&&(e=null),o!==e&&(o?.removeAttribute("data-swup-scroll-target"),e?.setAttribute("data-swup-scroll-target",""))}getRootScrollContainer(){return document.scrollingElement instanceof HTMLElement?document.scrollingElement:document.documentElement}scrollTo(t,o=!0,e){const n=this.swup.createVisit({to:this.swup.location.url}),{top:s=0,left:r=0}="number"==typeof t?{top:t}:t;e??=this.getRootScrollContainer(),(this.options.scrollFunction??this.applyScroll)(e,s,r,o,()=>this.swup.hooks.callSync("scroll:start",n,void 0),()=>this.swup.hooks.callSync("scroll:end",n,void 0))}applyScroll(t,o,e,n,s,r){const i=t instanceof HTMLHtmlElement||t instanceof HTMLBodyElement?window:t;s(),i.addEventListener("scrollend",r,{once:!0}),i.addEventListener("wheel",()=>{t.scrollTo({top:t.scrollTop,left:t.scrollLeft,behavior:"instant"})},{once:!0}),t.scrollTo({top:o,left:e,behavior:n?"smooth":"instant"})}scrollElementIntoView(t,o=!1){const e=(t=>{var o,e,n,r;if("undefined"==typeof document)return[];const{scrollMode:a,block:h,inline:u,boundary:d,skipOverflowHiddenElements:p}={scrollMode:"always",block:"start",inline:"start"},f="function"==typeof d?d:t=>t!==d;if(!s(t))throw new TypeError("Invalid target");const m=document.scrollingElement||document.documentElement,g=[];let w=t;for(;s(w)&&f(w);){if(w=c(w),w===m){g.push(w);break}null!=w&&w===document.body&&i(w)&&!i(document.documentElement)||null!=w&&i(w,p)&&g.push(w)}const S=null!=(e=null==(o=window.visualViewport)?void 0:o.width)?e:innerWidth,y=null!=(r=null==(n=window.visualViewport)?void 0:n.height)?r:innerHeight,{scrollX:T,scrollY:v}=window,{height:b,width:E,top:P,right:A,bottom:C,left:k}=t.getBoundingClientRect(),{top:H,right:R,bottom:L,left:W}=(t=>{const o=window.getComputedStyle(t);return{top:parseFloat(o.scrollMarginTop)||0,right:parseFloat(o.scrollMarginRight)||0,bottom:parseFloat(o.scrollMarginBottom)||0,left:parseFloat(o.scrollMarginLeft)||0}})(t);let M="start"===h||"nearest"===h?P-H:"end"===h?C+L:P+b/2-H+L,B="center"===u?k+E/2-W+R:"end"===u?A+R:k-W;const V=[];for(let t=0;t<g.length;t++){const o=g[t],{height:e,width:n,top:s,right:r,bottom:c,left:d}=o.getBoundingClientRect();if("if-needed"===a&&P>=0&&k>=0&&C<=y&&A<=S&&(o===m&&!i(o)||P>=s&&C<=c&&k>=d&&A<=r))return V;const p=getComputedStyle(o),f=parseInt(p.borderLeftWidth,10),w=parseInt(p.borderTopWidth,10),H=parseInt(p.borderRightWidth,10),R=parseInt(p.borderBottomWidth,10);let L=0,W=0;const j="offsetWidth"in o?o.offsetWidth-o.clientWidth-f-H:0,O="offsetHeight"in o?o.offsetHeight-o.clientHeight-w-R:0,q="offsetWidth"in o?0===o.offsetWidth?0:n/o.offsetWidth:0,I="offsetHeight"in o?0===o.offsetHeight?0:e/o.offsetHeight:0;if(m===o)L="start"===h?M:"end"===h?M-y:"nearest"===h?l(v,v+y,y,w,R,v+M,v+M+b,b):M-y/2,W="start"===u?B:"center"===u?B-S/2:"end"===u?B-S:l(T,T+S,S,f,H,T+B,T+B+E,E),L=Math.max(0,L+v),W=Math.max(0,W+T);else{L="start"===h?M-s-w:"end"===h?M-c+R+O:"nearest"===h?l(s,c,e,w,R+O,M,M+b,b):M-(s+e/2)+O/2,W="start"===u?B-d-f:"center"===u?B-(d+n/2)+j/2:"end"===u?B-r+H+j:l(d,r,n,f,H+j,B,B+E,E);const{scrollLeft:t,scrollTop:i}=o;L=0===I?0:Math.max(0,Math.min(i+L/I,o.scrollHeight-e/I+O)),W=0===q?0:Math.max(0,Math.min(t+W/q,o.scrollWidth-n/q+j)),M+=i-L,B+=t-W}V.push({el:o,top:L,left:W})}return V})(t);e.forEach(({top:e,left:n,el:s})=>{const{top:r=0,left:i=0}=this.getOffset(t,s,{top:e,left:n});this.scrollTo({top:e-r,left:n-i},o,s)})}}});
//# sourceMappingURL=index.umd.js.map
